import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.Random;

public class ArithmeticApp extends JFrame {

    private int num1, num2;
    private String operator;
    private double correctAnswer;
    private int difficultyLevel = 1;
    private int correctCount = 0;
    private int incorrectCount = 0;

    private JLabel num1Label, operatorLabel, num2Label, equalsLabel;
    private JTextField answerField;
    private JLabel feedbackLabel;
    private JLabel correctValueLabel, incorrectValueLabel;
    private JButton submitButton;
    private JButton continueButton;
    private JButton exitButton;

    private final Random random = new Random();

    public ArithmeticApp() {
        setTitle("Arithmetic Course");
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLayout(new BorderLayout(10, 10));

        initComponents();

        generateNewProblem();

        pack();
        setLocationRelativeTo(null);
        setVisible(true);
    }

    private void initComponents() {
        JPanel equationPanel = new JPanel(new BorderLayout());
        JPanel equationComponentsPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 10, 15));

        num1Label = new JLabel("?");
        operatorLabel = new JLabel("+");
        num2Label = new JLabel("?");
        equalsLabel = new JLabel("=");
        answerField = new JTextField(5);
        
        Font problemFont = new Font("SansSerif", Font.BOLD, 24);
        num1Label.setFont(problemFont);
        operatorLabel.setFont(problemFont);
        num2Label.setFont(problemFont);
        equalsLabel.setFont(problemFont);
        answerField.setFont(problemFont);
        answerField.setHorizontalAlignment(JTextField.CENTER);
        
        javax.swing.border.Border boxBorder = answerField.getBorder();
        Dimension preferredSize = answerField.getPreferredSize();
        Dimension boxSize = new Dimension(preferredSize.height, preferredSize.height);

        num1Label.setBorder(boxBorder);
        num2Label.setBorder(boxBorder);

        num1Label.setPreferredSize(boxSize);
        num2Label.setPreferredSize(boxSize);
        operatorLabel.setPreferredSize(boxSize);
        equalsLabel.setPreferredSize(boxSize);
        operatorLabel.setHorizontalAlignment(SwingConstants.CENTER);
        equalsLabel.setHorizontalAlignment(SwingConstants.CENTER);
        answerField.setPreferredSize(boxSize);

        equationComponentsPanel.add(num1Label);
        equationComponentsPanel.add(operatorLabel);
        equationComponentsPanel.add(num2Label);
        equationComponentsPanel.add(equalsLabel);
        equationComponentsPanel.add(answerField);
        
        equationPanel.add(equationComponentsPanel, BorderLayout.CENTER);

        JPanel problemAreaPanel = new JPanel(new BorderLayout());
        problemAreaPanel.add(equationPanel, BorderLayout.CENTER);
        

        feedbackLabel = new JLabel("Ready to start!", SwingConstants.CENTER);
        feedbackLabel.setFont(new Font("SansSerif", Font.ITALIC, 16));
        feedbackLabel.setPreferredSize(new Dimension(getWidth(), 30));

        JPanel scorePanel = new JPanel(new GridBagLayout());
        scorePanel.setBorder(BorderFactory.createEmptyBorder(10, 10, 10, 10));
        Font scoreTextFont = new Font("SansSerif", Font.BOLD, 14);

        JPanel correctScorePanel = new JPanel(new BorderLayout(0, 2));
        JLabel correctTextLabel = new JLabel("Correct:");
        correctTextLabel.setHorizontalAlignment(SwingConstants.CENTER);
        correctTextLabel.setForeground(new Color(34, 139, 34));
        correctTextLabel.setFont(scoreTextFont);
        correctValueLabel = new JLabel("0", SwingConstants.CENTER);
        correctValueLabel.setFont(problemFont);
        correctValueLabel.setBorder(boxBorder);
        correctValueLabel.setPreferredSize(boxSize);
        correctScorePanel.add(correctValueLabel, BorderLayout.CENTER);
        correctScorePanel.add(correctTextLabel, BorderLayout.SOUTH);

        JPanel incorrectScorePanel = new JPanel(new BorderLayout(0, 2));
        JLabel incorrectTextLabel = new JLabel("Incorrect:");
        incorrectTextLabel.setHorizontalAlignment(SwingConstants.CENTER);
        incorrectTextLabel.setForeground(new Color(220, 20, 60));
        incorrectTextLabel.setFont(scoreTextFont);
        incorrectValueLabel = new JLabel("0", SwingConstants.CENTER);
        incorrectValueLabel.setFont(problemFont);
        incorrectValueLabel.setBorder(boxBorder);
        incorrectValueLabel.setPreferredSize(boxSize);
        incorrectScorePanel.add(incorrectValueLabel, BorderLayout.CENTER);
        incorrectScorePanel.add(incorrectTextLabel, BorderLayout.SOUTH);

        JPanel scoresContainer = new JPanel();
        scoresContainer.setLayout(new BoxLayout(scoresContainer, BoxLayout.X_AXIS));
        scoresContainer.add(Box.createHorizontalGlue());
        scoresContainer.add(correctScorePanel);
        scoresContainer.add(Box.createHorizontalStrut(20));
        scoresContainer.add(incorrectScorePanel);
        scoresContainer.add(Box.createHorizontalGlue());

        scorePanel.add(scoresContainer);

        JPanel settingsPanel = new JPanel();
        settingsPanel.setLayout(new BoxLayout(settingsPanel, BoxLayout.Y_AXIS));
        settingsPanel.setBorder(BorderFactory.createEmptyBorder(0, 10, 0, 10));

        JPanel operationPanel = new JPanel();
        operationPanel.setLayout(new BoxLayout(operationPanel, BoxLayout.Y_AXIS));
        operationPanel.add(new JLabel("Operation:"));

        ButtonGroup operationGroup = new ButtonGroup();
        String[] opSymbols = {"+", "-", "*", "/"};
        String[] opNames = {"Addition", "Subtraction", "Multiplication", "Division"};

        for (int i = 0; i < opSymbols.length; i++) {
            final String opSymbol = opSymbols[i];
            JRadioButton opButton = new JRadioButton(opNames[i]);
            opButton.setActionCommand(opSymbol);
            if (i == 0) {
                opButton.setSelected(true);
            }

            opButton.addActionListener(e -> {
                operator = e.getActionCommand();
                generateNewProblem();
            });

            operationGroup.add(opButton);
            operationPanel.add(opButton);
        }

        JPanel levelPanel = new JPanel();
        levelPanel.setLayout(new BoxLayout(levelPanel, BoxLayout.Y_AXIS));
        levelPanel.add(new JLabel("Level:"));
        
        ButtonGroup levelGroup = new ButtonGroup();
        String[] levelNames = {"Level 1 (0-10)", "Level 2 (10-50)", "Level 3 (50-200)"};

        for (int i = 0; i < levelNames.length; i++) {
            final int level = i + 1;
            JRadioButton levelButton = new JRadioButton(levelNames[i]);
            if (i == 0) {
                levelButton.setSelected(true);
            }

            levelButton.addActionListener(e -> {
                difficultyLevel = level;
                generateNewProblem();
                updateProblemBoxSizes();
            });

            levelGroup.add(levelButton);
            levelPanel.add(levelButton);
        }

        settingsPanel.add(levelPanel);
        settingsPanel.add(Box.createVerticalStrut(20));
        settingsPanel.add(operationPanel);

        answerField.addActionListener(e -> {
            if (submitButton.isShowing()) checkAnswer();
        });

        JPanel mainContent = new JPanel(new BorderLayout());
        JPanel southPanel = new JPanel(new BorderLayout());
        mainContent.add(problemAreaPanel, BorderLayout.CENTER);
        mainContent.add(southPanel, BorderLayout.SOUTH);
        
        add(mainContent, BorderLayout.CENTER);
        add(scorePanel, BorderLayout.EAST);
        add(settingsPanel, BorderLayout.WEST);

        JPanel actionButtonPanel = new JPanel(new GridLayout(3, 1, 0, 5));
        submitButton = new JButton("Submit");
        continueButton = new JButton("Continue");
        exitButton = new JButton("Exit");
        actionButtonPanel.add(submitButton);
        actionButtonPanel.add(continueButton);
        actionButtonPanel.add(exitButton);
        equationComponentsPanel.add(actionButtonPanel);
        
        JPanel bottomControlsPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 20, 5));

        southPanel.add(feedbackLabel, BorderLayout.NORTH);
        southPanel.add(bottomControlsPanel, BorderLayout.CENTER);

        submitButton.addActionListener(e -> checkAnswer());
        continueButton.addActionListener(e -> generateNewProblem());
        exitButton.addActionListener(e -> System.exit(0));

        operator = "+";
    }

    private void updateProblemBoxSizes() {
        FontMetrics fm = answerField.getFontMetrics(answerField.getFont());
        int boxHeight = answerField.getPreferredSize().height;

        Dimension wideBoxSize = new Dimension(fm.stringWidth("888") + 20, boxHeight);
        Dimension squareBoxSize = new Dimension(boxHeight, boxHeight);

        if (difficultyLevel == 3) {
            num1Label.setPreferredSize(wideBoxSize);
            num2Label.setPreferredSize(wideBoxSize);
            answerField.setPreferredSize(wideBoxSize);
        } else {
            num1Label.setPreferredSize(squareBoxSize);
            num2Label.setPreferredSize(squareBoxSize);
            answerField.setPreferredSize(squareBoxSize);
        }
    }

    private void generateNewProblem() {
        int range;
        int minNum;
        
        switch (difficultyLevel) {
            case 1:
                minNum = 0;
                range = 10;
                break;
            case 2:
                minNum = 10;
                range = 40;
                break;
            case 3:
                minNum = 50;
                range = 150;
                break;
            default:
                minNum = 0;
                range = 10;
        }

        num1 = random.nextInt(range) + minNum;
        num2 = random.nextInt(range) + minNum;

        if ("/".equals(operator)) {
            while (num2 == 0) {
                num2 = random.nextInt(range) + minNum;
            }
            num1 = (num1 / num2) * num2;
            correctAnswer = (double)num1 / num2;
        } else if ("-".equals(operator)) {
             if (num1 < num2) {
                 int temp = num1;
                 num1 = num2;
                 num2 = temp;
             }
             correctAnswer = num1 - num2;
        } else if ("*".equals(operator)) {
            correctAnswer = (double)num1 * num2;
        } else {
            correctAnswer = (double)num1 + num2;
            operator = "+";
        }

        num1Label.setText(String.valueOf(num1));
        operatorLabel.setText(operator);
        num2Label.setText(String.valueOf(num2));
        feedbackLabel.setText(" ");
        answerField.setText("");
        answerField.requestFocusInWindow();

        submitButton.setVisible(true);
        answerField.setEditable(true);
    }

    private void checkAnswer() {
        try {
            double userAnswer = Double.parseDouble(answerField.getText().trim());

            boolean isCorrect = Math.abs(userAnswer - correctAnswer) < 0.0001;

            if (isCorrect) {
                correctCount++;
                JOptionPane.showMessageDialog(this, "Correct! Well done.", "Result", JOptionPane.INFORMATION_MESSAGE);
            } else {
                incorrectCount++;
                String message = "Incorrect. The correct answer was " + formatAnswer(correctAnswer);
                JOptionPane.showMessageDialog(this, message, "Result", JOptionPane.ERROR_MESSAGE);
            }

        } catch (NumberFormatException ex) {
            incorrectCount++;
            JOptionPane.showMessageDialog(this, "Please enter a valid number.", "Invalid Input", JOptionPane.WARNING_MESSAGE);
        }
        updateScoreDisplay();
        feedbackLabel.setText(" ");
        submitButton.setVisible(false);
        answerField.setEditable(false);
    }

    private void updateScoreDisplay() {
        correctValueLabel.setText(String.valueOf(correctCount));
        incorrectValueLabel.setText(String.valueOf(incorrectCount));
    }

    private String formatAnswer(double number) {
        if (number == (long) number) {
            return String.format("%d", (long) number);
        } else {
            return String.format("%.4f", number).replaceAll("0*$", "").replaceAll("\\.$", "");
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> {
            new ArithmeticApp();
        });
    }
}
